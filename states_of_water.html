<!doctype html>
<html>
<head>
<!--	Authors: Justin Fairbourn and Scott Ensign -->
<!--	Created at Utah State University with support from the Chemistry department and the Center for Innovative Design and Instruction. -->
	<meta charset="utf-8">
	<title>Water States and Structure</title>
	<link href="molecule-page.css" rel="stylesheet" type="text/css">
	<script src="jsmol/JSmol.min.js"></script>
	<script src="water_molecules.js"></script>
	<script>
		var info = {
			color: "#FFFFFF", 
			height: 500,      
			width: 500,
			j2sPath: "jsmol/j2s",
			// Change the initial molecule here.
			script: "load PDB/h2o.pdb; spacefill 20%; wireframe 0.15; spin off; frank on; background=white; antialiasDisplay=true;",
			debug: false
		};
	</script>
</head>

<body>
	<header>
		<div id="name" class="app">
			States and Structure of H<sub>2</sub>O
		</div>
	</header>
	
	<div id="instruction" class="app">
		<button>Previous</button>
		<p>Water molecules in ice are arranged in an ordered crystalline lattice called "hexagonal ice".</p>
		<button>Next</button>
	</div>
	
	<main>
		<aside id="description" class="notes app"></aside>
		
		<section class="molecule">

			<div id="window" class="app">
				<script type="text/javascript">
					Jmol.getApplet("main", info);
				</script>
			</div>

			<div id="controls" class="app">
				<div id="control_state" class="option">
					<strong>State:</strong>
					
					<select name="state" id="configuration" onChange="loadNew(this.value);"></select>
				</div>

				<div id="control_bg" class="option">
					<strong>Background Color:</strong>
					
					<input type="radio" name="bg_color" id="bg_white" onclick="changeColor('white');" checked="checked">
					<label for="bg_white">White</label>

					<input type="radio" name="bg_color" id="bg_black" onclick="changeColor('black');">
					<label for="bg_black">Black</label>

					<input type="radio" name="bg_color" id="bg_grey" onclick="changeColor('grey');">
					<label for="bg_grey">Grey</label>
					
<!--				
					Follow this template to add more colors: 
					<input type="radio" name="bg_color" id="{{NEW ID}}" onclick="changeColor('{{NEW COLOR}}');">
					<label for="{{NEW ID}}">{{NEW LABEL}}</label>
-->
				</div>

				<div id="control_model_type" class="option">
					<strong>Model Type:</strong>
					
					<input type="radio" name="model_type" id="mt_ballstick" onclick="ballAndStick();" checked="checked">
					<label for="mt_ballstick">Ball and Stick</label>

					<input type="radio" name="model_type" id="mt_spacefill" onclick="spacefill();">
					<label for="mt_spacefill">Spacefill</label>

					<input type="radio" name="model_type" id="mt_stick" onclick="stick();">
					<label for="mt_stick">Stick Only</label>
					
<!--
					Follow this template to add more configurations:
					<input type="radio" name="model_type" id="{{NEW ID}}" onclick="{{NEW FUNCTION}}">
					<label for="{{NEW ID}}">{{NEW LABEL}}</label>
-->
				</div>

				<div id="control_other" class="option">
					<strong>Show Other:</strong>
					
					<input type="checkbox" name="co_spin" id="co_spin" onClick="toggleSpin();">
					<label for="co_spin">Spin</label>
					
					<input type="checkbox" name="co_isosurface" id="co_isosurface" onClick="toggleIsosurface();">
					<label for="co_isosurface">Isosurface</label>
					
					<input type="checkbox" name="co_partialCharge" id="co_partialCharge" onClick="togglePartialCharge();">
					<label for="co_partialCharge">Partial Charge</label>
					
					<input type="checkbox" name="co_bondAngle" id="co_bondAngle" onClick="toggleBondAngle();">
					<label for="co_bondAngle">Angle</label>
				</div>
			</div>
		</section>
	</main>
	<script>
		// Functions so none of the html actually touches anything to do with JSmol directly.
		window.addEventListener("load", initWindow);

		function initWindow() {
			var moleculeSelect = document.getElementById('configuration');
			
			// initialize the 6 option elements
			var option01 = document.createElement("option");
			var option02 = document.createElement("option");
			var option03 = document.createElement("option");
			// var option04 = document.createElement("option");

			// assign each element a molecule object from carbon_molecules.js
			option01.molecule = h2o_single;
			option02.molecule = h2o_liquid;
			option03.molecule = h2o_ice;
			// option04.molecule = h2o_ice_hex;
			
			// label each element
			option01.label = "Gas: Single Molecule";			
			option02.label = "Liquid: Water";
			option03.label = "Solid: Ice";
			// option04.label = "Solid: Ice-Hex";
			
			// link each option to the select element
			moleculeSelect.add(option01);
			moleculeSelect.add(option02);
			moleculeSelect.add(option03);
			// moleculeSelect.add(option04);
			
			// IMPORTANT: Make sure one of the options is selected, or the loadNew() function call will not work.
			option01.selected = "selected";
			
			loadNew();
		}
		
		function getCurrentMolecule(){
			moleculeSelect = document.getElementById("configuration");
			return moleculeSelect.options[moleculeSelect.selectedIndex].molecule;
		}
		
		// Resets the inputs and loads the appropriate pdb file.
		function loadNew(pdbFile) {
			var molecule = getCurrentMolecule();
			
			var loadString = "load " + molecule.path + ";";
			
			if (molecule === h2o_single) {
				document.getElementById('co_bondAngle').disabled = false;
				document.getElementById('co_isosurface').disabled = false;
				document.getElementById('co_partialCharge').disabled = false;
			} else {
				document.getElementById('co_bondAngle').disabled = true;
				document.getElementById('co_isosurface').disabled = true;
				document.getElementById('co_partialCharge').disabled = true;
			}
			
			document.getElementById('description').innerHTML = molecule.description;
			document.getElementById('co_bondAngle').checked = false;
			document.getElementById('co_isosurface').checked = false;
			document.getElementById('co_partialCharge').checked = false;
			document.getElementById("mt_ballstick").checked = true;
			document.getElementById("co_spin").checked = false;
			
			Jmol.script(main, loadString);
		}
		
		function toggleIsosurface() {
			document.getElementById('co_partialCharge').checked = false;
			if (document.getElementById('co_isosurface').checked) {
				Jmol.script(main, 'isosurface vdw; isosurface translucent;');
			} else {
				Jmol.script(main, 'select *; isosurface off;');
			}
		}
		
		function togglePartialCharge() {
			document.getElementById('co_isosurface').checked = false;
			if (document.getElementById('co_partialCharge').checked) {
				Jmol.script(main, 'isosurface off; if ({atomno < 10}.partialcharge == 0){calculate partialcharge}; isosurface vdw map mep; isosurface translucent;');
			} else {
				Jmol.script(main, 'isosurface off;');
			}
		}
		
		function toggleBondAngle() {
			if (document.getElementById('co_bondAngle').checked) {
				Jmol.script(main, 'measure ({1}) ({0}) ({2});');
			} else {
				Jmol.script(main, 'measure off');
			}
		}
		
		function toggleSpin() {
			if (document.getElementById('co_spin').checked) {
				Jmol.script(main, 'spin on;');
			} else {
				Jmol.script(main, 'spin off;');
			}
		}
		
		function ballAndStick() {
			Jmol.script(main, 'wireframe 0.15; spacefill 20%');
		}
		
		function spacefill() {
			Jmol.script(main, 'spacefill 100%;');
		}
		
		function stick() {
			Jmol.script(main, 'wireframe 0.2; spacefill off;');
		}
		
// 		Create more functions by following this template:
//		
//		function function_name() {
//			Jmol.script(main, 'Jmol_command_string');
//		}
		
		function changeColor(color) {
			var colorString = 'background ' + color + ';';
			Jmol.script(main, colorString);
		}
	</script>
</body>
</html>
